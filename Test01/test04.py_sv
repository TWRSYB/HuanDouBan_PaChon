movie_datail_str = '{"id":"439345","number":"s","name":"シリーズ日本のマゾ女 鏡子VOL.13 川上ゆうプライベート調教記録","time":"6900","release_time":"2022-02-01 00":"00":"00","small_cover":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/small_cover.jpg","big_cove":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/big_cover.jpg","trailer":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/trailer.mp4","map":[{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_1.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_1.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_2.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_2.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_3.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_3.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_4.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_4.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_5.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_5.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_6.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_6.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_7.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_7.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_8.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_8.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_9.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_9.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_10.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_10.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_11.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_11.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_12.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_12.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_13.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_13.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_14.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_14.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_15.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_15.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_16.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_16.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_17.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_17.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_18.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_18.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_19.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_19.jpg"},{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_20.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_20.jpg"}],"score":"h","score_people":"c","comment_num":"c","flux_linkage_num":"A","flux_linkage":[{"name":"s","url":"Q","meta":"B","is-small":"a","is-warning":"a","tooltip":"a","time":"l"},{"name":"s","url":"R","meta":"B","is-small":"a","is-warning":"a","tooltip":"a","time":"l"},{"name":"S","url":"T","meta":"U","is-small":"a","is-warning":"a","tooltip":"a","time":"l"},{"name":"s","url":"Q","meta":"B","is-small":"a","is-warning":"b","tooltip":"b","time":"l"},{"name":"s","url":"R","meta":"B","is-small":"a","is-warning":"b","tooltip":"b","time":"l"},{"name":"S","url":"T","meta":"U","is-small":"a","is-warning":"b","tooltip":"b","time":"l"}],"flux_linkage_time":"l","created_at":"2022-04-20T20":"40":"30.000000Z","labels":[{"name":"捆綁","id":"222"},{"name":"SM","id":"226"},{"name":"灌腸","id":"241"},{"name":"紀錄片","id":"287"},{"name":"單體作品","id":"6851"}],"actors":[{"name":"川上ゆう♀","id":"1065","sex":"♀","is_like":"c"}],"seen":"c","want_see":"c","director":[{"name":"魁","id":"309","is_like":"c"}],"company":[{"name":"タイト","id":"630","is_like":"c"}],"series":[{"name":"日本のマゾ女","id":"25929","is_like":"c"}],"numbers":[{"name":"BDSM","id":"6339"}]}'
#
# eval1 = eval(movie_datail_str)
# print(eval1)


# 1 "遇到这个, 查找后面的第一个" 并 返回 str
# 1 '遇到这个, 查找后面的第一个' 并 返回 str
# 2 ,遇到这个, 先判断是从{进来的还是从[进来的
# [遇到这个, 执行获取元素操作, 直到遇到] 返回 list
# {遇到这个, 执行获取键值对操作, 直到遇到}后返回一个dict
# def get_entry_list(i, rest_of_str):
#     for
#     pass
#
#
# def aaa(rest_of_str):
#     for i in range(0, len(rest_of_str)):
#         if rest_of_str[i] == '{':
#             new_dict = {}
#             get_entry_list(i)
#             return new_dict

class StrToContainer:
    def __init__(self, the_str):
        self.the_str = the_str
        self.index = 0

    def get_monomer(self, close_symbol=''):
        """
        获取一个单体: dict 或 list 或 str
        :param close_symbol: 结束符号, 在非预期开头时, 使用该符号作为结尾返回一个字符串
        :return:
        """
        self.pass_empty()
        if self.the_str[self.index] == '{':
            new_dict = {}
            self.add_entry_for_dict(new_dict)
            print(f"当前index: {self.index}, 获取到一个dict: {new_dict}")
            return new_dict
        elif self.the_str[self.index] == '[':
            new_list = []
            self.add_element_for_list(new_list)
            print(f"当前index: {self.index}, 获取到一个list: {new_list}")
            return new_list
        else:
            new_str = ''
            if self.the_str[self.index] == '"':
                self.index += 1
                new_str = self.get_quote_str(new_str, '"')
                print(f'当前index: {self.index}, 获取到一个"str": {new_str}')
                self.index += 1
            elif self.the_str[self.index] == "'":
                self.index += 1
                new_str = self.get_quote_str(new_str, "'")
                print(f"当前index: {self.index}, 获取到一个'str': {new_str}")
                self.index += 1
            else:
                new_str = self.get_no_quote_str(new_str, close_symbol)
                print(f"当前index: {self.index}, 获取到一个str: {new_str}")
            return new_str

    def add_entry_for_dict(self, new_dict):
        """
        在获取单体时遇到 { 则会进入填充 dict 的逻辑, 递归为 dict 添加元素, 直到遇到 } 结束逻辑
        :param new_dict:
        :return:
        """
        self.index += 1
        self.pass_empty()
        if self.get_close('}'):
            return new_dict
        else:
            key = '' if self.get_close(':') else self.get_monomer(':')
            self.index += 1
            value = '' if self.get_close(',') else self.get_monomer([',', '}'])
            new_dict[key] = value
            if self.get_close('}'):
                self.index += 1
                return new_dict
            self.add_entry_for_dict(new_dict)

    def add_element_for_list(self, new_list):
        """
        在获取单体时遇到 [ , 则会进入填充 list 的逻辑, 递归为 list 添加元素, 直到遇到 ] 结束逻辑
        :param new_list: 新的列表
        :return: 新的列表
        """
        self.index += 1
        self.pass_empty()
        if self.get_close(']'):
            return new_list
        else:
            element = '' if self.get_close(',') else self.get_monomer([',', ']'])
            new_list.append(element)
            if self.get_close(']'):
                self.index += 1
                return new_list
            self.add_element_for_list(new_list)

    def get_quote_str(self, new_str, quote):
        """
        获取单体时, 如果是以引号开头, 则开启获取字符串逻辑, 拼接字符串, 直到遇到下一个对应的引号结束
        :param quote: 引号 ' 或 "
        :param new_str:
        :return:
        """
        if self.get_close(quote):
            return new_str.strip()
        else:
            new_str = new_str + self.the_str[self.index]
            self.index += 1
            return self.get_quote_str(new_str, quote)

    def get_no_quote_str(self, new_str, end_symbol=[',', ' ', '}', ']']):
        """
        获取单体时, 如果单体不是 dict 或 list 且不是以引号开头, 则开启获取字符串逻辑, 拼接字符串, 直到遇到下一个对应结束符号
        :param end_symbol: 结束符号
        :param new_str:
        :return:
        """
        if self.get_close(end_symbol):
            return new_str.strip()
        else:
            new_str = new_str + self.the_str[self.index]
            self.index += 1
            return self.get_no_quote_str(new_str, end_symbol)

    def get_close(self, symbol):
        """
        用于判断是否到达结束符号, 用于调用逻辑的结束判断
        :param symbol: 结束符号
        :return: bool
        """
        if self.the_str[self.index] in symbol:
            if self.the_str[self.index - 1] == '\\':
                if self.the_str[self.index - 2] == '\\':
                    if self.the_str[self.index - 3] == '\\':
                        return False
                    else:
                        return True
                else:
                    return False
            else:
                return True
        else:
            return False


    def pass_empty(self):
        """
        在获取下一个单体前 跳过空格
        :return: None
        """
        if self.the_str[self.index] in [' ']:
            self.index += 1
            self.pass_empty()



# the_str = "[{aaa: 'bbb'},{'ccc':888}]"
# the_str = "{aaa: 'bbb', 'ccc':888}"
the_str = '{id:439345,number:s,name:"シリーズ日本のマゾ女 鏡子VOL.13 川上ゆうプライベート調教記録",time:6900,release_time:"2022-02-01 00:00:00",small_cover:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/small_cover.jpg",big_cove:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/big_cover.jpg",trailer:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/trailer.mp4",map:[{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_1.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_1.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_2.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_2.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_3.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_3.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_4.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_4.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_5.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_5.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_6.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_6.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_7.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_7.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_8.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_8.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_9.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_9.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_10.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_10.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_11.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_11.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_12.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_12.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_13.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_13.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_14.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_14.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_15.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_15.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_16.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_16.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_17.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_17.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_18.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_18.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_19.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_19.jpg"},{img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_20.jpg",big_img:"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_20.jpg"}],score:h,score_people:c,comment_num:c,flux_linkage_num:A,flux_linkage:[{name:s,url:Q,meta:B,"is-small":a,"is-warning":a,tooltip:a,time:l},{name:s,url:R,meta:B,"is-small":a,"is-warning":a,tooltip:a,time:l},{name:S,url:T,meta:U,"is-small":a,"is-warning":a,tooltip:a,time:l},{name:s,url:Q,meta:B,"is-small":a,"is-warning":b,tooltip:b,time:l},{name:s,url:R,meta:B,"is-small":a,"is-warning":b,tooltip:b,time:l},{name:S,url:T,meta:U,"is-small":a,"is-warning":b,tooltip:b,time:l}],flux_linkage_time:l,created_at:"2022-04-20T20:40:30.000000Z",labels:[{name:"捆綁",id:222},{name:"SM",id:226},{name:"灌腸",id:241},{name:"紀錄片",id:287},{name:"單體作品",id:6851}],actors:[{name:"川上ゆう♀",id:1065,sex:"♀",is_like:c}],seen:c,want_see:c,director:[{name:"魁",id:309,is_like:c}],company:[{name:"タイト",id:630,is_like:c}],series:[{name:"日本のマゾ女",id:25929,is_like:c}],numbers:[{name:"BDSM",id:6339}]}'
# the_str = movie_datail_str
# the_str = '{"map":[{"img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_img_1.jpg","big_img":"https://wimg.9618599.com/resources/javdb.com/626058758d565120fcb67326/preview_big_img_1.jpg"}]}'
# print({i:c for i,c in enumerate(the_str)})
print([(i,c) for i,c in enumerate(the_str)])
str_to_container = StrToContainer(the_str)
monomer = str_to_container.get_monomer()
print(monomer)
